ACLOCAL_AMFLAGS = -I build/autotools

SUBDIRS = build codegen clutter examples

if ENABLE_DOCS
SUBDIRS += docs
endif

pyclutter-1.0.pc: pyclutter.pc
	@cp -f $< $(@F)

pkgfiles = pyclutter-1.0.pc
pkgconfigdir = $(libdir)/pkgconfig
pkgconfig_DATA = $(pkgfiles)

DISTCHECK_CONFIGURE_FLAGS = --enable-docs

DIST_SUBDIRS = \
	build \
	codegen \
	docs \
	clutter \
	examples

EXTRA_DIST = py-compile Makefile.tmpl

CLEANFILES = $(pkgfiles)

# Extra clean files so that maintainer-clean removes *everything*
MAINTAINERCLEANFILES = \
	aclocal.m4 \
	compile \
	config.guess \
	config.sub \
        configure \
	depcomp \
	install-sh \
	ltmain.sh \
	Makefile.in \
	missing \
	config.h.in

PREV_RELEASE=git-import

dist-hook:
	@if test -d "$(srcdir)/.git"; \
	then \
		to=""; \
		from="$(PREV_RELEASE)"; \
		echo Creating ChangeLog && \
		( cd "$(top_srcdir)" && \
		  echo '# Generated by configure.  Do no edit.'; echo; \
		  $(top_srcdir)/missing --run perl $(top_srcdir)/build/gen-changelog.pl $$from..$$to ) > ChangeLog.tmp \
		&& mv -f ChangeLog.tmp $(top_distdir)/ChangeLog \
		|| ( rm -f ChangeLog.tmp ; \
		     echo Failed to generate ChangeLog >&2 ); \
	else \
		echo A git checkout is required to generate a ChangeLog >&2; \
	fi
